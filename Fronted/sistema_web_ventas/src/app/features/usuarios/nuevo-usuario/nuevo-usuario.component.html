<div class="container py-4">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2 class="mb-0">Lista de Usuarios</h2>
      <button 
        class="btn btn-primary" 
        (click)="showAddModal = true"
        style="background-color: #6d122e; border-color: #6d122e; color: white;"
      >
        + Agregar usuario
      </button>
    </div>
    <div class="card-body">
      <div class="d-flex justify-content-end mb-3">
        <div class="input-group w-25">
          <input 
            type="text" 
            class="form-control" 
            placeholder="Buscar:" 
            (input)="filtrarUsuarios($event)"
          >
        </div>
      </div>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Opcciones</th>
              <th>Nombre</th>
              <th>Tipo Doc.</th>
              <th>N° Doc.</th>
              <th>Dirección</th>
              <th>Teléfono</th>
              <th>Email</th>
              <th>Cargo</th>
              <th>Login</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let usuario of filteredUsuarios">
              <td>
                <button class="btn btn-info btn-sm me-1" (click)="openChangePasswordModal(usuario)">
                  <i class="bi bi-key"></i>
                </button>
                <button 
                  class="btn btn-sm" 
                  [ngClass]="{'btn-danger': usuario.estado === 'Activo', 'btn-success': usuario.estado === 'Inactivo'}"
                  (click)="toggleUsuarioEstado(usuario)"
                >
                  <i class="bi" [ngClass]="{'bi-trash': usuario.estado === 'Activo', 'bi-check': usuario.estado === 'Inactivo'}"></i>
                </button>
              </td>
              <td>{{ usuario.nombre }}</td>
              <td>{{ usuario.tipoDocumento }}</td>
              <td>{{ usuario.numeroDocumento }}</td>
              <td>{{ usuario.direccion || 'N/A' }}</td>
              <td>{{ usuario.telefono }}</td>
              <td>{{ usuario.email || 'N/A' }}</td>
              <td>{{ usuario.cargo || 'N/A' }}</td>
              <td>{{ usuario.login }}</td>
              <td>
                <span class="badge" [ngClass]="{'bg-success': usuario.estado === 'Activo', 'bg-danger': usuario.estado === 'Inactivo'}">
                  {{ usuario.estado }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="d-flex justify-content-between align-items-center mt-3">
        <small>Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} a {{ currentPage * itemsPerPage }} de {{ usuarios.length }} entradas</small>
        <div>
          <button class="btn btn-outline-secondary btn-sm me-2" (click)="previousPage()" [disabled]="currentPage === 1">Anterior</button>
          <span *ngFor="let page of pageNumbers" class="mx-1" [ngClass]="{'text-primary': currentPage === page}">
            <button class="btn btn-sm btn-outline-secondary" (click)="goToPage(page)">{{ page }}</button>
          </span>
          <button class="btn btn-outline-secondary btn-sm" (click)="nextPage()" [disabled]="currentPage === totalPages">Siguiente</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de agregar usuario -->
  <div class="modal" tabindex="-1" [class.show]="showAddModal" (click)="closeAddModal()" role="dialog">
    <div class="modal-dialog modal-dialog-centered" (click)="($event.stopPropagation())">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Agregar Usuario</h5>
          <button type="button" class="btn-close" (click)="closeAddModal()"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="usuarioForm" class="row g-3">
            <div class="col-12">
              <label for="nombre" class="form-label">Nombre:</label>
              <input type="text" id="nombre" formControlName="nombre" class="form-control" required>
            </div>
            <div class="col-12 col-md-6">
              <label for="tipoDocumento" class="form-label">Tipo de Documento:</label>
              <select id="tipoDocumento" formControlName="tipoDocumento" class="form-control" required>
                <option value="DNI">DNI</option>
                <option value="RUC">RUC</option>
                <option value="Pasaporte">Pasaporte</option>
              </select>
            </div>
            <div class="col-12 col-md-6">
              <label for="numeroDocumento" class="form-label">Número de Documento:</label>
              <input type="text" id="numeroDocumento" formControlName="numeroDocumento" class="form-control" required>
            </div>
            <div class="col-12">
              <label for="direccion" class="form-label">Dirección:</label>
              <input type="text" id="direccion" formControlName="direccion" class="form-control">
            </div>
            <div class="col-12 col-md-6">
              <label for="telefono" class="form-label">Teléfono:</label>
              <input type="text" id="telefono" formControlName="telefono" class="form-control">
            </div>
            <div class="col-12 col-md-6">
              <label for="email" class="form-label">Email:</label>
              <input type="email" id="email" formControlName="email" class="form-control">
            </div>
            <div class="col-12">
              <label for="cargo" class="form-label">Cargo:</label>
              <input type="text" id="cargo" formControlName="cargo" class="form-control">
            </div>
            <div class="col-12 col-md-6">
              <label for="login" class="form-label">Login:</label>
              <input type="text" id="login" formControlName="login" class="form-control" required>
            </div>
            <div class="col-12 col-md-6">
              <label for="clave" class="form-label">Clave:</label>
              <input type="password" id="clave" formControlName="clave" class="form-control" required>
            </div>
            <div class="col-12">
              <h5>Permisos</h5>
              <div class="row">
                <div class="col-6 col-md-4 mb-2" *ngFor="let permiso of permisos">
                  <div class="form-check">
                    <input 
                      type="checkbox" 
                      class="form-check-input" 
                      [id]="'permiso_' + permiso" 
                      [formControlName]="permiso" 
                      (change)="onPermisoChange($event, permiso)"
                    >
                    <label class="form-check-label" [for]="'permiso_' + permiso">{{ permiso }}</label>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Cancelar</button>
          <button type="button" class="btn btn-primary" (click)="agregarUsuario()" [disabled]="usuarioForm.invalid">
            Guardar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de cambiar clave -->
  <div class="modal" tabindex="-1" [class.show]="showChangePasswordModal" (click)="closeChangePasswordModal()" role="dialog">
    <div class="modal-dialog modal-dialog-centered" (click)="($event.stopPropagation())">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Cambiar Clave</h5>
          <button type="button" class="btn-close" (click)="closeChangePasswordModal()"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="changePasswordForm" class="row g-3">
            <div class="col-12">
              <label for="nuevaClave" class="form-label">Nueva Clave:</label>
              <input type="password" id="nuevaClave" formControlName="nuevaClave" class="form-control" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeChangePasswordModal()">Cancelar</button>
          <button type="button" class="btn btn-primary" (click)="cambiarClave()" [disabled]="changePasswordForm.invalid">
            Guardar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>